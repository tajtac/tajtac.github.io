import{SLIDES_SELECTOR}from"../utils/constants.js";import{queryAll,createStyleSheet}from"../utils/util.js";export default class Print{constructor(e){this.Reveal=e}async setupPDF(){const e=this.Reveal.getConfig(),t=queryAll(this.Reveal.getRevealElement(),SLIDES_SELECTOR),i=e.slideNumber&&/all|print/i.test(e.showSlideNumber),s=this.Reveal.getComputedSlideSize(window.innerWidth,window.innerHeight),a=Math.floor(s.width*(1+e.margin)),n=Math.floor(s.height*(1+e.margin)),o=s.width,r=s.height;await new Promise(requestAnimationFrame),createStyleSheet("@page{size:"+a+"px "+n+"px; margin: 0px;}"),createStyleSheet(".reveal section>img, .reveal section>video, .reveal section>iframe{max-width: "+o+"px; max-height:"+r+"px}"),document.documentElement.classList.add("print-pdf"),document.body.style.width=a+"px",document.body.style.height=n+"px",await new Promise(requestAnimationFrame),this.Reveal.layoutSlideContents(o,r),t.forEach(e=>this.Reveal.slideContent.layout(e)),await new Promise(requestAnimationFrame);const l=t.map(e=>e.scrollHeight),c=[],d=t[0].parentNode;t.forEach(function(t,s){if(!1===t.classList.contains("stack")){let d=(a-o)/2,h=(n-r)/2;const m=l[s];let p=Math.max(Math.ceil(m/n),1);(1===(p=Math.min(p,e.pdfMaxPagesPerSlide))&&e.center||t.classList.contains("center"))&&(h=Math.max((n-m)/2,0));const f=document.createElement("div");if(c.push(f),f.className="pdf-page",f.style.height=(n+e.pdfPageHeightOffset)*p+"px",f.appendChild(t),t.style.left=d+"px",t.style.top=h+"px",t.style.width=o+"px",t.slideBackgroundElement&&f.insertBefore(t.slideBackgroundElement,t),e.showNotes){const i=this.Reveal.getSlideNotes(t);if(i){const t=8,s="string"==typeof e.showNotes?e.showNotes:"inline",n=document.createElement("div");n.classList.add("speaker-notes"),n.classList.add("speaker-notes-pdf"),n.setAttribute("data-layout",s),n.innerHTML=i,"separate-page"===s?c.push(n):(n.style.left=t+"px",n.style.bottom=t+"px",n.style.width=a-2*t+"px",f.appendChild(n))}}if(i){const e=s+1,t=document.createElement("div");t.classList.add("slide-number"),t.classList.add("slide-number-pdf"),t.innerHTML=e,f.appendChild(t)}if(e.pdfSeparateFragments){const e=this.Reveal.fragments.sort(f.querySelectorAll(".fragment"),!0);let t;e.forEach(function(e){t&&t.forEach(function(e){e.classList.remove("current-fragment")}),e.forEach(function(e){e.classList.add("visible","current-fragment")},this);const i=f.cloneNode(!0);c.push(i),t=e},this),e.forEach(function(e){e.forEach(function(e){e.classList.remove("visible","current-fragment")})})}else queryAll(f,".fragment:not(.fade-out)").forEach(function(e){e.classList.add("visible")})}},this),await new Promise(requestAnimationFrame),c.forEach(e=>d.appendChild(e)),this.Reveal.dispatchEvent({type:"pdf-ready"})}isPrintingPDF(){return/print-pdf/gi.test(window.location.search)}};